From a1ef7cc47d41c3293ad9284513c0ed0fab6ddcfe Mon Sep 17 00:00:00 2001
From: Ondrej Jirman <megi@xff.cz>
Date: Mon, 22 May 2023 04:41:08 +0200
Subject: [PATCH 20/56] video: console: Fix default font selection

Some callers expect to call this with NULL font name to select the
default font (eg. boot/scene.c). Without handling the NULL condition
U-Boot crashes instead of displaying a bootflow GUI menu.

Signed-off-by: Ondrej Jirman <megi@xff.cz>
---
 drivers/video/console_core.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/video/console_core.c b/drivers/video/console_core.c
index 1f93b1b85fa..b5d0e3dceca 100644
--- a/drivers/video/console_core.c
+++ b/drivers/video/console_core.c
@@ -201,6 +201,12 @@ int console_simple_select_font(struct udevice *dev, const char *name, uint size)
 {
 	struct video_fontdata *font;
 
+	if (!name) {
+		if (fonts->name)
+			console_set_font(dev, fonts);
+		return 0;
+	}
+
 	for (font = fonts; font->name; font++) {
 		if (!strcmp(name, font->name)) {
 			console_set_font(dev, font);
-- 
2.39.2

